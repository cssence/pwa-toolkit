<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Console</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<link rel="stylesheet" href="/init.css">
<style>
html{background-color:#000;color:#eee}
body{--footer-size:var(--header-size)}
[data-online="false"]{--connection:orange}
[data-online="true"]{--connection:#80ff80}
#content,#bottom{font-family:monospace}
#content{overflow-wrap:break-word;margin:0;padding:1em 0;border:none}
#content li{margin:0 2ch 0 5ch}
#bottom label,#content li::marker{color:#777}
#bottom input,#bottom button{background:inherit;outline:none}
#bottom{display:flex;align-items:center;gap:1ch;padding:0 2ch;border:0 solid #202225;border-top-width:var(--border-size)}
#bottom input{display:block;width:100%;margin:0;padding:.5em 0;border:none}
#bottom input:focus{outline:none}
#bottom button{width:2ch;height:1.5em;padding:0;border:1px outset transparent;font-family:sans-serif;color:var(--connection,#777);text-align:center;outline:none}
#bottom button:focus{border-color:#777}
[data-state]{color:var(--state,#777)}
[data-state="error"]{--state:orangered}
[data-state="warning"]{--state:orange}
[data-state="ok"]{--state:#80ff80}
</style>
<link rel="icon" href="/favicon.ico" sizes="any">
<link rel="icon" href="/icon.png" type="image/png">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<link rel="manifest" href="/manifest.webmanifest">
</head>
<body><script type="module">
import init from '/init.js';
(async () => {
	if (!('serviceWorker' in navigator)) return;
	await init('console', 'Console');

	$('script').insertAdjacentHTML('beforebegin', '<ol id="content" aria-label="Log entries"></ol>');
	$('script').insertAdjacentHTML('beforebegin', `<form id="bottom" name="bottom" action="." method="get">${[
		'<label for="prompt" aria-label="Command">$&gt;</label>',
		'<input id="prompt" name="prompt" type="text">',
		'<button type="submit" aria-label="Execute">‚èé</button>'
	].join('')}</form>`);

	const prompt = $('#prompt');
	const log = $('#content');
	const LOG_ENTRY = 'li';
	if ('onLine' in navigator) {
		const updateConnectivity = () => {
			$('html').setAttribute('data-online', navigator.onLine);
		};
		updateConnectivity();
		window.addEventListener('online', updateConnectivity);
		window.addEventListener('offline', updateConnectivity);
	}
	navigator.serviceWorker.register('/sw.js').then((registration) => {
		const swOutput = document.createElement(LOG_ENTRY);
		swOutput.setAttribute('data-state', 'ok');
		swOutput.textContent = 'ServiceWorker activated';
		log.append(swOutput);
	}).catch((err) => {
		const swOutput = document.createElement(LOG_ENTRY);
		swOutput.setAttribute('data-state', 'error');
		swOutput.textContent = err;
		log.append(swOutput);
	});
	$('#bottom').addEventListener('submit', (event) => {
		event.preventDefault();
		if (!prompt.value) return;
		const evalOutput = document.createElement(LOG_ENTRY);
		try {
			const result = eval(prompt.value);
			evalOutput.textContent = typeof result === 'undefined' ? 'undefined' : result;
			evalOutput.setAttribute('data-state', evalOutput.textContent === 'undefined' ? 'undefined' : 'ok');
		} catch (err) {
			evalOutput.setAttribute('data-state', 'error');
			evalOutput.textContent = err;
		}
		log.append(evalOutput);
		evalOutput.scrollIntoView();
		prompt.select();
	});
	prompt.focus();
})();
</script></body>
</html>
